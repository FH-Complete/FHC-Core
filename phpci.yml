build_settings:
    verbose: false
    prefer_symlink: false
    ignore:
        - "vendor"
        - "tests"
    pgsql:
        host: 'localhost;dbname=template1'
        user: 'fhcomplete'
        pass: 'fhcomplete'
setup:
    composer:
#        directory: ""
#        action: "install"
        prefer_dist: true
        no_dev: true
    pgsql:
        - "UPDATE pg_database SET datallowconn='false' WHERE datname='fhctest';"
        - "SELECT pg_terminate_backend(pid) FROM pg_stat_activity WHERE datname='fhctest';"
        - "DROP DATABASE IF EXISTS fhctest;"
    shell:
#        - "pkill -f fhctest &"
#        - "sudo -u postgres psql fhctest -c 'DROP DATABASE IF EXISTS fhctest;'"
        - "cd %BUILD_PATH% && chmod u+x install.sh && ./install.sh fhctest" # Install Database
        - "rm -f /var/www/html/build/fhcomplete" # SymLink l√∂schen falls vorhanden
        - "ln -s %BUILD_PATH% /var/www/html/build/fhcomplete" # SymLink to the actual build
#        - "php index.ci.php DBTools migrate" # DB-Migration

test:
    lint:
        directories:
        - "application/"
        recursive: true
    php_loc:
#    php_docblock_checker:
#        path: "application/controllers/"
#        allowed_warnings: 100
#        skip_classes: false
#    php_code_sniffer:
#        path: "application/controllers/"
#        standard: "tests/codesniffer/FHComplete"
#        allowed_errors: 200
#        allowed_warnings: 200
    codeception:
        config: "tests/codeception/"
        path: "tests/codeception/_output/"
#    php_unit:
#        directory: "tests/phpunit/"

complete:
#    xmpp:
#        username: "fhcomplete"
#        password: "fhcomplete1q2w3blah.im"
#        recipients:
#            - "fhcomplete@darkness.su"
#            - "nk@jabber.at" 
#            - "tschux@jabber.org"
#            - "tschux@jabber.at"      
#        server: "jabber.blah.im"
#        tls: 1
#        alias: "jabber.blah.im"
#        date_format: "%d.%m.%Y"
    clean_build:
        remove:
            - index.php
            - config/global.config.inc.php
            - config/cis.config.inc.php
            - config/vilesci.config.inc.php
            - config/system.config.inc.php

success:
#    shell:
#        - "cd %BUILD_PATH% && chmod u+x copyBuild.sh && ./copyBuild.sh" # Copy Build
#        - "curl 'http://localhost/backend/Migrate/'" # DB-Installation
#        - "cd /var/www/html/ && sudo -u wsp doxygen Doxyfile" # Doxygen

